---
workflow_id: smartspec_implement_ui_from_spec
version: "6.0.0"
status: active
category: ui
platform_support:
  - cli
  - kilo
requires_apply: true
---

# smartspec_implement_ui_from_spec

**Generate platform-specific UI implementation code from A2UI specification.**

## Purpose

This workflow generates production-ready, platform-specific UI code from an A2UI specification. It supports multiple platforms (Web/Lit, Flutter, React, Angular) and generates complete implementations including components, TypeScript types, unit tests, and Storybook stories.

## Governance contract

This workflow MUST follow:
- `knowledge_base_smartspec_handbook.md` (v6)
- A2UI Specification v0.8
- `.spec/smartspec.config.yaml`
- `.spec/ui-catalog.json`
- Target platform best practices

## Prerequisites

**Required:**
- A2UI must be enabled in `.spec/smartspec.config.yaml`
- Valid UI specification file (generated by `smartspec_generate_ui_spec`)
- UI component catalog (`.spec/ui-catalog.json`)
- Target platform renderer dependencies installed

**Optional:**
- Existing codebase for integration
- Custom component templates
- Style framework configuration

## Invocation

### CLI

```bash
/smartspec_implement_ui_from_spec \
  --spec specs/feature/spec-002-contact/ui-spec.json \
  --target-platform web \
  --renderer lit \
  --output-dir src/ui/contact \
  --apply
```

### Kilo Code

```bash
/smartspec_implement_ui_from_spec.md \
  --spec specs/feature/spec-002-contact/ui-spec.json \
  --target-platform web \
  --renderer lit \
  --output-dir src/ui/contact \
  --platform kilo \
  --apply
```

## Flags

### Universal Flags

| Flag | Type | Required | Description |
|------|------|----------|-------------|
| `--apply` | boolean | No | Apply changes (default: preview mode) |
| `--platform` | string | No | Platform: cli, kilo (default: cli) |
| `--verbose` | boolean | No | Verbose output |
| `--dry-run` | boolean | No | Simulate without changes |
| `--report-dir` | path | No | Custom report directory |
| `--force` | boolean | No | Force overwrite existing files |

### Workflow-Specific Flags

| Flag | Type | Required | Description |
|------|------|----------|-------------|
| `--spec` | path | Yes | Path to UI specification JSON file |
| `--target-platform` | string | Yes | Target platform: web, flutter, mobile |
| `--renderer` | string | No | Renderer: lit, react, angular, flutter (default: from config) |
| `--output-dir` | path | Yes | Output directory for generated code |
| `--typescript` | boolean | No | Generate TypeScript (default: from config) |
| `--tests` | boolean | No | Generate unit tests (default: from config) |
| `--storybook` | boolean | No | Generate Storybook stories (default: from config) |
| `--style-framework` | string | No | Style framework: material, fluent, custom (default: from config) |
| `--component-prefix` | string | No | Component name prefix (e.g., "App", "My") |
| `--module-name` | string | No | Module/package name |
| `--base-path` | path | No | Base import path for generated components |

### Flag Usage Notes

**Path Safety:**
- Output directory must be within allowed write roots
- Use relative paths from project root
- Existing files will be overwritten if `--force` is set

**Renderer Selection:**
- `lit`: Web Components with Lit (recommended for web)
- `react`: React components with hooks
- `angular`: Angular components with TypeScript
- `flutter`: Flutter widgets for mobile

**TypeScript:**
- Generates `.ts` files instead of `.js`
- Includes type definitions for data models
- Type-safe component props

**Tests:**
- Generates unit tests for each component
- Uses platform-specific testing framework
- Includes accessibility tests

**Storybook:**
- Generates `.stories.ts` files
- Interactive component documentation
- Visual regression testing support

## Behavior

### Preview Mode (default)

1. **Validate Prerequisites**
   - Check A2UI is enabled
   - Verify UI spec exists and is valid
   - Check catalog exists
   - Validate renderer dependencies

2. **Parse UI Specification**
   - Load and validate UI spec JSON
   - Extract surfaces and components
   - Analyze data model
   - Identify actions and bindings

3. **Validate Against Catalog**
   - Check all components exist in catalog
   - Verify component properties
   - Validate security levels

4. **Generate Code (in memory)**
   - Generate component files
   - Generate TypeScript types
   - Generate unit tests (if enabled)
   - Generate Storybook stories (if enabled)
   - Generate index/barrel files
   - Generate README

5. **Create Preview**
   - Save generated code to report directory
   - Create file tree visualization
   - Generate component diagram
   - Create usage examples

6. **Generate Report**
   - List all generated files
   - Show code statistics
   - Display next steps
   - Provide apply command

7. **Prompt for Apply**
   - Instruct user to review generated code
   - Provide command to run with `--apply`

### Apply Mode (`--apply`)

1. **Perform all preview mode steps**

2. **Write to Output Directory**
   - Create output directory if needed
   - Write all generated files
   - Preserve existing files (unless `--force`)
   - Set file permissions

3. **Update Project Configuration**
   - Add dependencies to package.json (if needed)
   - Update tsconfig.json (if TypeScript)
   - Update import paths

4. **Generate Integration Guide**
   - Create IMPLEMENTATION.md
   - Document how to use components
   - Provide integration examples
   - List next steps

5. **Report Success**
   - Display file paths
   - Show import examples
   - Suggest verification workflow

## Output

### Preview Mode

```
.spec/reports/implement-ui-from-spec/<run-id>/
├── components/                    # Generated component files
│   ├── ContactForm.ts
│   ├── NameField.ts
│   ├── EmailField.ts
│   ├── MessageField.ts
│   └── SubmitButton.ts
├── types/                         # TypeScript type definitions
│   └── ContactFormTypes.ts
├── tests/                         # Unit tests
│   ├── ContactForm.test.ts
│   ├── NameField.test.ts
│   └── ...
├── stories/                       # Storybook stories (if enabled)
│   ├── ContactForm.stories.ts
│   └── ...
├── index.ts                       # Barrel export
├── README.md                      # Usage documentation
├── file-tree.txt                  # File structure
├── component-diagram.png          # Visual diagram
└── report.md                      # Full report
```

### Apply Mode (additional)

```
<output-dir>/
├── components/                    # Generated components (final)
├── types/                         # Type definitions (final)
├── tests/                         # Unit tests (final)
├── stories/                       # Storybook stories (final)
├── index.ts                       # Barrel export (final)
├── README.md                      # Usage docs (final)
└── IMPLEMENTATION.md              # Integration guide
```

## Example Usage

### Example 1: Web with Lit

**Generate code:**
```bash
/smartspec_implement_ui_from_spec \
  --spec specs/feature/spec-002-contact/ui-spec.json \
  --target-platform web \
  --renderer lit \
  --output-dir src/ui/contact \
  --typescript \
  --tests \
  --apply
```

**Generated files:**
```
src/ui/contact/
├── components/
│   ├── ContactForm.ts          # Main form component
│   ├── NameField.ts            # Name input
│   ├── EmailField.ts           # Email input
│   ├── MessageField.ts         # Message textarea
│   └── SubmitButton.ts         # Submit button
├── types/
│   └── ContactFormTypes.ts     # TypeScript types
├── tests/
│   ├── ContactForm.test.ts
│   └── ...
├── index.ts                     # Export all components
└── README.md                    # Usage guide
```

**Usage:**
```typescript
import { ContactForm } from './ui/contact';

// Use in your app
const form = document.createElement('contact-form');
document.body.appendChild(form);
```

### Example 2: Flutter

**Generate code:**
```bash
/smartspec_implement_ui_from_spec \
  --spec specs/feature/spec-003-dashboard/ui-spec.json \
  --target-platform flutter \
  --output-dir lib/ui/dashboard \
  --tests \
  --apply
```

**Generated files:**
```
lib/ui/dashboard/
├── dashboard_screen.dart        # Main screen
├── widgets/
│   ├── metrics_card.dart
│   ├── chart_widget.dart
│   └── activity_table.dart
├── models/
│   └── dashboard_data.dart      # Data models
├── test/
│   ├── dashboard_screen_test.dart
│   └── ...
└── README.md
```

**Usage:**
```dart
import 'package:myapp/ui/dashboard/dashboard_screen.dart';

// Use in your app
Navigator.push(
  context,
  MaterialPageRoute(builder: (context) => DashboardScreen()),
);
```

### Example 3: React with TypeScript

**Generate code:**
```bash
/smartspec_implement_ui_from_spec \
  --spec specs/feature/spec-004-booking/ui-spec.json \
  --target-platform web \
  --renderer react \
  --output-dir src/components/booking \
  --typescript \
  --tests \
  --storybook \
  --apply
```

**Generated files:**
```
src/components/booking/
├── BookingForm.tsx              # Main component
├── DatePicker.tsx
├── TimeSelector.tsx
├── GuestCount.tsx
├── SpecialRequests.tsx
├── types.ts                     # TypeScript types
├── __tests__/
│   ├── BookingForm.test.tsx
│   └── ...
├── __stories__/
│   ├── BookingForm.stories.tsx
│   └── ...
├── index.ts
└── README.md
```

**Usage:**
```tsx
import { BookingForm } from './components/booking';

function App() {
  return <BookingForm onSubmit={handleSubmit} />;
}
```

### Example 4: With Custom Prefix

**Generate code:**
```bash
/smartspec_implement_ui_from_spec \
  --spec specs/feature/spec-005-settings/ui-spec.json \
  --target-platform web \
  --renderer lit \
  --output-dir src/ui/settings \
  --component-prefix "App" \
  --module-name "my-app-settings" \
  --typescript \
  --apply
```

**Generated components:**
- `AppSettingsForm` (instead of `SettingsForm`)
- `AppThemeSelector` (instead of `ThemeSelector`)
- etc.

**Custom element names:**
- `<app-settings-form>` (instead of `<settings-form>`)
- `<app-theme-selector>` (instead of `<theme-selector>`)

## Generated Code Structure

### Web (Lit)

**Component file:**
```typescript
import { LitElement, html, css } from 'lit';
import { customElement, property } from 'lit/decorators.js';

@customElement('contact-form')
export class ContactForm extends LitElement {
  @property({ type: Object }) data = { name: '', email: '', message: '' };

  static styles = css`
    :host {
      display: block;
      padding: 16px;
    }
    /* Material Design styles */
  `;

  render() {
    return html`
      <form @submit=${this._handleSubmit}>
        <name-field .value=${this.data.name} @change=${this._handleNameChange}></name-field>
        <email-field .value=${this.data.email} @change=${this._handleEmailChange}></email-field>
        <message-field .value=${this.data.message} @change=${this._handleMessageChange}></message-field>
        <submit-button label="Send Message"></submit-button>
      </form>
    `;
  }

  private _handleSubmit(e: Event) {
    e.preventDefault();
    this.dispatchEvent(new CustomEvent('submit', { detail: this.data }));
  }

  // ... other handlers
}
```

### Flutter

**Widget file:**
```dart
import 'package:flutter/material.dart';

class ContactForm extends StatefulWidget {
  final Function(Map<String, dynamic>) onSubmit;

  const ContactForm({Key? key, required this.onSubmit}) : super(key: key);

  @override
  _ContactFormState createState() => _ContactFormState();
}

class _ContactFormState extends State<ContactForm> {
  final _formKey = GlobalKey<FormState>();
  String _name = '';
  String _email = '';
  String _message = '';

  @override
  Widget build(BuildContext context) {
    return Form(
      key: _formKey,
      child: Column(
        children: [
          TextFormField(
            decoration: InputDecoration(labelText: 'Name'),
            validator: (value) => value?.isEmpty ?? true ? 'Required' : null,
            onSaved: (value) => _name = value ?? '',
          ),
          TextFormField(
            decoration: InputDecoration(labelText: 'Email'),
            keyboardType: TextInputType.emailAddress,
            validator: (value) => value?.isEmpty ?? true ? 'Required' : null,
            onSaved: (value) => _email = value ?? '',
          ),
          TextFormField(
            decoration: InputDecation(labelText: 'Message'),
            maxLines: 6,
            validator: (value) => value?.isEmpty ?? true ? 'Required' : null,
            onSaved: (value) => _message = value ?? '',
          ),
          ElevatedButton(
            onPressed: _handleSubmit,
            child: Text('Send Message'),
          ),
        ],
      ),
    );
  }

  void _handleSubmit() {
    if (_formKey.currentState!.validate()) {
      _formKey.currentState!.save();
      widget.onSubmit({'name': _name, 'email': _email, 'message': _message});
    }
  }
}
```

## Evidence sources

When answering questions, the agent MUST read:

1) **Knowledge base**
   - `knowledge_base_smartspec_handbook.md`
   - `knowledge_base_smartspec_install_and_usage.md`
   - `.smartspec/WORKFLOW_PARAMETERS_REFERENCE.md`
   - `.smartspec/WORKFLOW_SCENARIOS_GUIDE.md`

2) **A2UI Resources**
   - A2UI Specification v0.8
   - `.spec/ui-catalog.json`
   - `docs/a2ui/A2UI_SmartSpec_Integration_Report.md`
   - `a2ui_workflow_specifications.md`

3) **Configuration**
   - `.spec/smartspec.config.yaml` (a2ui section)

4) **UI Specification**
   - The UI spec file specified in `--spec`

5) **Platform Documentation**
   - Lit documentation (for web/lit)
   - React documentation (for web/react)
   - Flutter documentation (for flutter)
   - Angular documentation (for web/angular)

## Best Practices

### Output Directory Structure

**Good:**
```
src/ui/<feature-name>/
├── components/
├── types/
├── tests/
└── index.ts
```

**Bad:**
```
src/
├── ContactForm.ts
├── NameField.ts
└── ... (flat structure)
```

### Component Naming

- **Use PascalCase** for component class names
- **Use kebab-case** for custom element names (web)
- **Add prefix** for namespacing (optional but recommended)
- **Be descriptive** but concise

### Code Organization

- **One component per file** - Easy to maintain
- **Barrel exports** - Clean imports
- **Separate types** - Reusable type definitions
- **Co-locate tests** - Tests near components

### Accessibility

- **Include ARIA labels** - All interactive elements
- **Keyboard navigation** - Tab order, focus management
- **Screen reader support** - Semantic HTML
- **Color contrast** - WCAG-AA minimum

## Troubleshooting

### Error: "A2UI not enabled"

**Solution:**
```yaml
# Enable in .spec/smartspec.config.yaml
a2ui:
  enabled: true
```

### Error: "UI spec not found"

**Solution:** Generate UI spec first:
```bash
/smartspec_generate_ui_spec \
  --requirements "..." \
  --spec specs/feature/spec-002-contact/ui-spec.json \
  --apply
```

### Error: "Renderer dependencies not installed"

**Solution:**
```bash
# For Lit
npm install lit

# For React
npm install react react-dom

# For Flutter
flutter pub add flutter
```

### Error: "Component not in catalog"

**Solution:** The UI spec references a component not in catalog. Either:
1. Update catalog to include component
2. Regenerate UI spec with approved components

### Error: "Output directory not in allowed write roots"

**Solution:** Check `.spec/smartspec.config.yaml`:
```yaml
write_roots:
  - src/
  - lib/
```

## Related Workflows

**Before implementing:**

1. **Generate UI spec:**
   ```bash
   /smartspec_generate_ui_spec \
     --requirements "..." \
     --spec specs/feature/spec-002-contact/ui-spec.json \
     --apply
   ```

**After implementing:**

2. **Verify implementation:**
   ```bash
   /smartspec_verify_ui_implementation \
     --spec specs/feature/spec-002-contact/ui-spec.json \
     --implementation src/ui/contact \
     --target-platform web
   ```

3. **Generate tasks:**
   ```bash
   /smartspec_generate_tasks \
     specs/feature/spec-002-contact/spec.md \
     --apply
   ```

## Security Considerations

- **Catalog validation** - Only approved components generated
- **Path validation** - Output directory validated against allowlist
- **Code injection prevention** - All user input sanitized
- **Dependency pinning** - Generated code uses pinned versions

## Version History

- **6.0.0** (2025-12-22): Initial release with A2UI v0.8 support

---

**Status:** Active  
**Requires Apply:** Yes (for final code generation)  
**Platform Support:** CLI, Kilo  
**Category:** UI Generation
