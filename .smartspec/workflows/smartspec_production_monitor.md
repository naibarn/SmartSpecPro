---
name: /smartspec_production_monitor
version: 1.0.0
role: production-ops
category: core
write_guard: ALLOW-WRITE
purpose: Monitor production health, generate alerts, and feed metrics back into the SmartSpec ecosystem.
description: Monitor production health, generate alerts, and feed metrics back into the SmartSpec ecosystem.
workflow: /smartspec_production_monitor
---

# smartspec_production_monitor

> **Canonical path:** `.smartspec/workflows/smartspec_production_monitor.md`  
> **Version:** 1.0.0  
> **Status:** Production Ready  
> **Category:** production-ops

## Purpose

This workflow provides a bridge between production operations and the SmartSpec ecosystem. It monitors production health, generates alerts for anomalies, and feeds performance metrics back to be used in future spec generation and planning.

This workflow MUST:

- Integrate with common observability platforms (e.g., Prometheus, Datadog, Grafana).
- Track key performance indicators (KPIs) against the NFRs defined in the corresponding `spec.md`.
- Generate alerts when KPIs deviate from their service-level objectives (SLOs).
- Create performance reports that can be fed into the `smartspec_feedback_aggregator`.
- Be highly available and resilient.

---

## File Locations (Important for AI Agents)

**All SmartSpec configuration and registry files are located in the `.spec/` folder:**
- **Config:** `.spec/smartspec.config.yaml`
- **Spec Index:** `.spec/SPEC_INDEX.json`
- **Registry:** `.spec/registry/`
- **Reports:** `.spec/reports/`

---

## Governance contract

This workflow MUST follow:

- `knowledge_base_smartspec_handbook.md` (v7)
- `.spec/smartspec.config.yaml`

### Write scopes (enforced)

Allowed writes (safe outputs):

- `.spec/reports/production-monitoring/**`

Forbidden writes (must hard-fail):

- Any path outside config `safety.allow_writes_only_under`

### `--apply` behavior

- This workflow does not have an `--apply` behavior as it does not write to governed paths.

---

## Threat model (minimum)

This workflow must defend against:

- **Secret Leakage:** API keys for observability platforms must never be logged or exposed.
- **Data Integrity:** Ensure that metrics are not tampered with.
- **Denial of Service:** Implement rate limiting to prevent abuse of observability platform APIs.

---

## Invocation

```bash
/smartspec_production_monitor \
  --spec-id <spec-id> \
  [--run-once] \
  [--daemon]
```

---

## Inputs

- `--spec-id <spec-id>`: The ID of the spec to monitor.
- `--run-once`: Run the monitoring check once and exit.
- `--daemon`: Run continuously as a background process.

---

## Flags (Universal)

- `--help`: Show help message.
- `--version`: Show version.
- `--verbose`: Enable verbose logging.
- `--quiet`: Suppress all output except errors.

---

## Behavior (Vibe Coding)

### Phase 1: Configuration

1.  **Load Spec:** Load the `spec.md` for the deployed service.
2.  **Extract NFRs:** Parse the Non-Functional Requirements (NFRs) section to get the target SLOs (e.g., p99 latency < 200ms, error rate < 0.1%).
3.  **Load Observability Config:** Load the `observability.yaml` generated by `smartspec_observability_configurator` to get the correct metric names and dashboard URLs.

### Phase 2: Monitoring Loop (Continuous)

1.  **Query Metrics:** Periodically query the observability platform's API for the relevant metrics.
2.  **Compare to SLOs:** Compare the current metric values against the target SLOs from the spec.
3.  **Update Health Status:** Maintain a real-time health status for the service.

### Phase 3: Alerting

1.  **If SLO Breach Detected:**
    -   **Generate Alert:** Create a structured alert containing the service name, breached metric, current value, and target value.
    -   **Trigger Incident:** Send the alert to the `smartspec_incident_response` workflow to initiate the incident management process.

### Phase 4: Reporting

1.  **Generate Performance Report:** On a schedule (e.g., daily, weekly), generate a summary report of performance against SLOs.
2.  **Save Report:** Save the report in a structured format (e.g., JSON) in `.spec/reports/production-monitoring/`.
3.  **Notify Feedback Aggregator:** Trigger the `smartspec_feedback_aggregator` to process the new performance report.

---

## Output Structure

- **Alerts:** Sent to `smartspec_incident_response`.
- **Reports:** Saved in `.spec/reports/production-monitoring/`.
- **Logs:** Standard monitoring logs.

---

## `summary.json` Schema

```json
{
  "workflow": "smartspec_production_monitor",
  "version": "1.0.0",
  "run_id": "string",
  "spec_id": "string",
  "status": "healthy|unhealthy|degraded",
  "metrics": [
    {
      "name": "p99_latency",
      "value": 150,
      "slo": 200,
      "status": "healthy"
    }
  ]
}
```
