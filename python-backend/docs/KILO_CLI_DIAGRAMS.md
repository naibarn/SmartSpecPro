# Kilo Code CLI Integration - UML Diagrams

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° UML Diagrams ‡∏ó‡∏µ‡πà‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Kilo Code CLI Integration ‡πÉ‡∏ô SmartSpec Pro

## 1. Activity Diagram - ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á Kilo CLI Integration ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏ô‡∏à‡∏ö

![Kilo CLI Activity Diagram](diagrams/kilo_cli_activity.png)

### ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ Phases

| Phase | ‡∏™‡∏µ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|-------|-----|----------|
| **üöÄ Initialization** | ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô | ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CLI ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Session |
| **üí° Skill Injection** | ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß | ‡∏î‡∏∂‡∏á Memory ‡πÅ‡∏•‡∏∞ Inject Skills |
| **‚ö° Execution** | ‡∏™‡πâ‡∏° | ‡∏£‡∏±‡∏ô Kilo CLI ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå |
| **üìä Result Processing** | ‡∏°‡πà‡∏ß‡∏á | ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Metrics |
| **üîÑ State Sync** | ‡∏ü‡πâ‡∏≤ | Sync Checkpoints ‡πÅ‡∏•‡∏∞ Tasks |
| **üíæ Memory Storage** | ‡∏ä‡∏°‡∏û‡∏π | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Episodic Memory |
| **üßπ Cleanup** | ‡πÄ‡∏ó‡∏≤ | ‡∏õ‡∏¥‡∏î Session ‡πÅ‡∏•‡∏∞ Cleanup |

---

## 2. Sequence Diagram - ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Methods

‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å methods ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á components ‡∏ï‡πà‡∏≤‡∏á‡πÜ

![Kilo CLI Sequence Diagram](diagrams/kilo_cli_sequence.png)

### Components ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

| Component | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà |
|-----------|--------|
| **Workflow Orchestrator** | ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| **Session Manager** | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Kilo Sessions |
| **Skill Manager** | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Skills ‡πÅ‡∏•‡∏∞ Injection |
| **State Sync** | Sync State ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á SmartSpec ‚Üî Kilo |
| **Kilo CLI** | ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ CLI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö coding |
| **Git Repository** | ‡πÄ‡∏Å‡πá‡∏ö code changes ‡πÅ‡∏•‡∏∞ checkpoints |
| **Memory Services** | Semantic + Episodic Memory |

---

## 3. State Diagram - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á Kilo Session

‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á state transitions ‡∏Ç‡∏≠‡∏á Kilo Session

![Kilo Session State Diagram](diagrams/kilo_session_state.png)

### Session States

| State | ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|-------|----------|----------|
| **Created** | üÜï | Session ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á initialize |
| **Idle** | ‚è∏Ô∏è | ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö task ‡πÉ‡∏´‡∏°‡πà |
| **Running** | üîÑ | ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô task ‡∏≠‡∏¢‡∏π‡πà |
| **Error** | ‚ö†Ô∏è | ‡πÄ‡∏Å‡∏¥‡∏î error (recoverable ‡∏´‡∏£‡∏∑‡∏≠ fatal) |
| **Timeout** | ‚è±Ô∏è | Task timeout, ‡∏Å‡∏≥‡∏•‡∏±‡∏á kill process |
| **Stopped** | üõë | Session ‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß |

### State Transitions

```
Created ‚Üí Idle       : CLI verified, session ready
Idle ‚Üí Running       : execute_task() called
Running ‚Üí Idle       : Task completed successfully
Running ‚Üí Error      : Task failed
Running ‚Üí Timeout    : Timeout exceeded
Error ‚Üí Idle         : Retry successful
Error ‚Üí Stopped      : Fatal error
Timeout ‚Üí Idle       : Process killed, ready for retry
Idle ‚Üí Stopped       : close_session() called
```

---

## 4. ‡∏™‡∏£‡∏∏‡∏õ Flow ‡∏´‡∏•‡∏±‡∏Å

### 4.1 Happy Path (Normal Execution)

```
1. Check CLI Available ‚úì
2. Create Session ‚úì
3. Initialize Sync State ‚úì
4. Get Semantic Memories ‚úì
5. Inject SmartSpec Context ‚úì
6. Setup Project Skills ‚úì
7. Receive Task from Workflow ‚úì
8. Build & Execute Kilo Command ‚úì
9. Parse JSON Output ‚úì
10. Update Metrics ‚úì
11. Record Checkpoint & Task ‚úì
12. Store Episode (optional) ‚úì
13. Close Session ‚úì
```

### 4.2 Fallback Path (CLI Not Available)

```
1. Check CLI Available ‚úó
2. Fallback to LLM Execution
3. Use LCEL Chains
4. Return LLM Result
```

### 4.3 Error Recovery Path

```
1. Task Execution Failed
2. Record Error in State
3. Check if Recoverable
   - Yes: Retry with same/modified prompt
   - No: Mark as Fatal, close session
4. Sync Error State
```

---

## 5. Key Decision Points

| Decision | Yes Path | No Path |
|----------|----------|---------|
| CLI Available? | Create Session | Fallback to LLM |
| Has Memories? | Inject Context | Skip to Default Skills |
| Task Successful? | Extract Result | Record Error |
| New Checkpoint? | Record Mapping | Skip to Task Record |
| Store Episode? | Save to ChromaDB | Continue |
| More Tasks? | Loop to Receive Task | Cleanup |

---

## 6. ‡πÑ‡∏ü‡∏•‡πå Diagram Sources

‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö Mermaid ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:

- `diagrams/kilo_cli_activity.mmd` - Activity Diagram
- `diagrams/kilo_cli_sequence.mmd` - Sequence Diagram
- `diagrams/kilo_session_state.mmd` - State Diagram

### ‡∏Å‡∏≤‡∏£ Render ‡πÉ‡∏´‡∏°‡πà

```bash
# Render Activity Diagram
manus-render-diagram diagrams/kilo_cli_activity.mmd diagrams/kilo_cli_activity.png

# Render Sequence Diagram
manus-render-diagram diagrams/kilo_cli_sequence.mmd diagrams/kilo_cli_sequence.png

# Render State Diagram
manus-render-diagram diagrams/kilo_session_state.mmd diagrams/kilo_session_state.png
```

---

## 7. Related Documentation

- [Priority 2 Report](PRIORITY_2_REPORT.md) - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£ implement
- [Kilo CLI Research](kilo_cli_research.md) - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Kilo CLI
- [Comprehensive Plan](COMPREHENSIVE_PLAN.md) - ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
